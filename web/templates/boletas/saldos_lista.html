{% extends "base.html" %}

{% block title %}Saldos de Clientes - Sistema de Cobro de Agua{% endblock %}

{% block content %}
<!-- HEADER -->
<div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
    <h1 class="text-2xl font-bold">Saldos de Clientes</h1>
    <a href="{{ url_for('boletas.pagos_lista') }}" class="btn btn-ghost">
        <i class="fas fa-arrow-left"></i>
        <span class="hidden sm:inline">Volver a Pagos</span>
    </a>
</div>

<!-- STATS - colapsable -->
{% if stats %}
<div class="collapse collapse-arrow bg-base-100 shadow mb-4 hidden lg:block">
    <input type="checkbox" id="stats-toggle" />
    <div class="collapse-title font-medium flex items-center gap-2">
        <i class="fas fa-chart-bar text-primary"></i>
        Resumen
    </div>
    <div class="collapse-content">
        <div class="stats stats-vertical lg:stats-horizontal shadow w-full">
            <div class="stat">
                <div class="stat-title">Total Clientes</div>
                <div class="stat-value text-lg">{{ stats.total or 0 }}</div>
            </div>
            <div class="stat">
                <div class="stat-title">Con Saldo</div>
                <div class="stat-value text-lg text-success">{{ stats.con_saldo or 0 }}</div>
            </div>
            <div class="stat">
                <div class="stat-title">Total Saldo</div>
                <div class="stat-value text-lg text-info">${{ (stats.total_saldo or 0)|formato_pesos }}</div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<p class="text-base-content/70 mb-4 hidden lg:block">Lista de clientes con su saldo a favor disponible.</p>

{% if saldos %}
<!-- CARDS - solo mobile -->
<div class="lg:hidden space-y-2" id="cardsContainer">
    {% for s in saldos %}
    <a href="{{ url_for('boletas.saldo_detalle', cliente_id=s.id) }}" class="card bg-base-100 shadow {% if s.saldo_disponible > 0 %}border-l-4 border-l-success{% endif %}">
        <div class="card-body py-4 px-4 flex-row items-center justify-between">
            <div class="min-w-0">
                <div class="font-semibold">{{ s.nombre }}</div>
                <div class="text-sm text-base-content/70 truncate">{{ s.nombre_completo or '-' }}</div>
            </div>
            <div class="flex items-center gap-3">
                <span class="font-bold {% if s.saldo_disponible > 0 %}text-success{% endif %}">
                    ${{ s.saldo_disponible|formato_pesos }}
                </span>
                <i class="fas fa-chevron-right text-base-content/30"></i>
            </div>
        </div>
    </a>
    {% endfor %}
</div>

<!-- TABLE - solo desktop -->
<div class="overflow-x-auto hidden lg:block">
    <table class="table table-zebra bg-base-100">
        <thead>
            <tr>
                <th class="sortable">ID</th>
                <th class="sortable">Cliente</th>
                <th class="sortable">Nombre Completo</th>
                <th class="sortable">Saldo Disponible</th>
                <th class="sortable">Ultima Actualizacion</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for s in saldos %}
            <tr class="hover">
                <td>{{ s.id }}</td>
                <td>{{ s.nombre }}</td>
                <td>{{ s.nombre_completo or '-' }}</td>
                <td>
                    <span class="{% if s.saldo_disponible > 0 %}text-success font-bold{% endif %}">
                        ${{ s.saldo_disponible|formato_pesos }}
                    </span>
                </td>
                <td>{{ s.ultima_actualizacion.strftime('%d/%m/%Y %H:%M') if s.ultima_actualizacion else '-' }}</td>
                <td>
                    <a href="{{ url_for('boletas.saldo_detalle', cliente_id=s.id) }}" class="btn btn-ghost btn-xs btn-square" title="Ver detalle">
                        <i class="fas fa-eye"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<!-- Empty state -->
<div class="card bg-base-100 shadow">
    <div class="card-body items-center text-center py-12">
        <i class="fas fa-wallet text-5xl text-base-content/30 mb-4"></i>
        <h3 class="card-title">No hay saldos</h3>
        <p class="text-base-content/70 mb-4">No hay clientes con saldo registrado.</p>
    </div>
</div>
{% endif %}

<script>
// Restore stats collapse state
(function() {
    var saved = localStorage.getItem('saldos-stats-open');
    if (saved === '1') {
        var toggle = document.getElementById('stats-toggle');
        if (toggle) toggle.checked = true;
    }
    document.getElementById('stats-toggle')?.addEventListener('change', function() {
        localStorage.setItem('saldos-stats-open', this.checked ? '1' : '0');
    });
})();
</script>
{% endblock %}
