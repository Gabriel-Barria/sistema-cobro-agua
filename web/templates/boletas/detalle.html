{% extends "base.html" %}

{% block title %}Boleta {{ boleta.numero_boleta }} - Sistema de Lecturas{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Boleta {{ boleta.numero_boleta }}</h1>
    <div>
        <a href="{{ url_for('boletas.descargar', boleta_id=boleta.id) }}" class="btn btn-primary">Descargar</a>
        <a href="{{ url_for('boletas.listar') }}" class="btn btn-secondary">Volver</a>
    </div>
</div>

<div class="detail-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
    <div class="detail-section">
        <h3>Datos del Cliente</h3>
        <table class="detail-table">
            <tr>
                <th>Cliente:</th>
                <td>{{ boleta.cliente_nombre }}</td>
            </tr>
            <tr>
                <th>Medidor ID:</th>
                <td>{{ boleta.medidor_id }}</td>
            </tr>
            <tr>
                <th>Periodo:</th>
                <td>{{ boleta.periodo_mes }}/{{ boleta.periodo_a√±o }}</td>
            </tr>
            <tr>
                <th>Fecha Emision:</th>
                <td>{{ boleta.fecha_emision }}</td>
            </tr>
        </table>
    </div>

    <div class="detail-section">
        <h3>Estado de Pago</h3>
        <div style="padding: 15px; background: {{ '#d4edda' if boleta.pagada else '#fff3cd' }}; border-radius: 5px;">
            {% if boleta.pagada %}
                <span class="badge badge-success" style="font-size: 16px;">PAGADA</span>
                <p style="margin-top: 10px;">
                    <strong>Fecha de pago:</strong> {{ boleta.fecha_pago }}<br>
                    <strong>Metodo:</strong> {{ boleta.metodo_pago|capitalize }}
                </p>
                {% if boleta.comprobante_path %}
                    <p><strong>Comprobante:</strong> <a href="/{{ boleta.comprobante_path }}" target="_blank">Ver comprobante</a></p>
                {% else %}
                    <p class="alert alert-warning" style="margin-top: 10px;">Sin comprobante adjunto</p>
                {% endif %}
            {% else %}
                <span class="badge badge-danger" style="font-size: 16px;">PENDIENTE</span>
            {% endif %}
        </div>
    </div>
</div>

<div class="detail-section" style="margin-top: 20px;">
    <h3>Detalle de Consumo</h3>
    <table class="data-table">
        <thead>
            <tr>
                <th>Concepto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Cargo Fijo</td>
                <td>1</td>
                <td>${{ boleta.cargo_fijo|formato_pesos }}</td>
                <td>${{ boleta.cargo_fijo|formato_pesos }}</td>
            </tr>
            <tr>
                <td>
                    Consumo de agua
                    <small style="display: block; color: #666;">
                        Lectura actual: {{ boleta.lectura_actual }} m3
                        {% if boleta.lectura_anterior %}
                        | Anterior: {{ boleta.lectura_anterior }} m3
                        {% endif %}
                    </small>
                </td>
                <td>{{ boleta.consumo_m3 }} m3</td>
                <td>${{ boleta.precio_m3|formato_pesos }}</td>
                <td>${{ boleta.subtotal_consumo|formato_pesos }}</td>
            </tr>
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; font-size: 1.2em;">
                <td colspan="3" style="text-align: right;">TOTAL:</td>
                <td>${{ boleta.total|formato_pesos }}</td>
            </tr>
        </tfoot>
    </table>
</div>

<div class="actions-section" style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 5px;">
    <h3>Acciones</h3>

    {% if not boleta.pagada %}
    <div style="margin-bottom: 20px;">
        <h4>Marcar como pagada</h4>
        <form method="POST" action="{{ url_for('boletas.marcar_pagada', boleta_id=boleta.id) }}" style="display: flex; gap: 10px; align-items: end;">
            <div class="form-group" style="margin: 0;">
                <label for="metodo_pago">Metodo de pago:</label>
                <select name="metodo_pago" id="metodo_pago" required>
                    <option value="efectivo">Efectivo</option>
                    <option value="transferencia">Transferencia</option>
                </select>
            </div>
            <button type="submit" class="btn btn-success">Marcar Pagada</button>
        </form>
    </div>
    {% else %}
    <div style="margin-bottom: 20px;">
        <form method="POST" action="{{ url_for('boletas.desmarcar_pagada', boleta_id=boleta.id) }}"
              onsubmit="return confirm('Estas seguro de desmarcar esta boleta como pagada?');">
            <button type="submit" class="btn btn-warning">Desmarcar Pagada</button>
        </form>
    </div>
    {% endif %}

    {% if boleta.pagada %}
    <div style="margin-bottom: 20px;">
        <h4>Subir Comprobante</h4>
        <form method="POST" action="{{ url_for('boletas.subir_comprobante', boleta_id=boleta.id) }}"
              enctype="multipart/form-data" style="display: flex; gap: 10px; align-items: end;">
            <div class="form-group" style="margin: 0;">
                <label for="comprobante">Archivo (imagen o PDF):</label>
                <input type="file" name="comprobante" id="comprobante" accept=".jpg,.jpeg,.png,.gif,.pdf" required>
            </div>
            <button type="submit" class="btn btn-primary">Subir</button>
        </form>
    </div>
    {% endif %}

    <div style="border-top: 1px solid #ddd; padding-top: 20px; margin-top: 20px;">
        <form method="POST" action="{{ url_for('boletas.eliminar', boleta_id=boleta.id) }}"
              onsubmit="return confirm('Estas seguro de eliminar esta boleta? Esta accion no se puede deshacer.');">
            <button type="submit" class="btn btn-danger">Eliminar Boleta</button>
        </form>
    </div>
</div>

<style>
.detail-section {
    background: white;
    padding: 20px;
    border-radius: 5px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.detail-table {
    width: 100%;
}
.detail-table th {
    text-align: left;
    padding: 8px;
    width: 40%;
    background: #f9f9f9;
}
.detail-table td {
    padding: 8px;
}
.badge {
    display: inline-block;
    padding: 5px 10px;
    border-radius: 3px;
    font-weight: bold;
}
.badge-success { background: #28a745; color: white; }
.badge-danger { background: #dc3545; color: white; }
.btn-success { background: #28a745; color: white; }
.btn-warning { background: #ffc107; color: black; }
.btn-danger { background: #dc3545; color: white; }
</style>
{% endblock %}
